<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Cookie vs JWT Comparison - DevAuth</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: white;
      overflow: hidden;
    }
    
    .header {
      background: #16213e;
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #0f3460;
    }
    
    .header h1 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    
    .header p {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .split-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      height: calc(100vh - 100px);
    }
    
    .side {
      padding: 20px;
      overflow-y: auto;
      border-right: 2px solid #0f3460;
    }
    
    .side:last-child {
      border-right: none;
    }
    
    .jwt-side {
      background: linear-gradient(135deg, #1a1a2e 0%, #2d1b69 100%);
    }
    
    .cookie-side {
      background: linear-gradient(135deg, #1a1a2e 0%, #6d1b3d 100%);
    }
    
    .side-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(255,255,255,0.1);
    }
    
    .side-icon {
      font-size: 3rem;
      margin-bottom: 10px;
    }
    
    .side-title {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    
    .side-subtitle {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    .start-btn {
      width: 100%;
      padding: 15px;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
    }
    
    .jwt-btn {
      background: #667eea;
      color: white;
    }
    
    .jwt-btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }
    
    .cookie-btn {
      background: #f5576c;
      color: white;
    }
    
    .cookie-btn:hover {
      background: #e04558;
      transform: translateY(-2px);
    }
    
    .flow-steps {
      margin-top: 20px;
    }
    
    .step {
      background: rgba(255,255,255,0.05);
      border-left: 4px solid transparent;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      opacity: 0.3;
      transition: all 0.3s;
    }
    
    .step.active {
      opacity: 1;
      border-left-color: #28a745;
      background: rgba(40, 167, 69, 0.1);
    }
    
    .step.current {
      opacity: 1;
      border-left-color: #ffc107;
      background: rgba(255, 193, 7, 0.1);
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    .step-number {
      display: inline-block;
      width: 30px;
      height: 30px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      margin-right: 10px;
      font-weight: 600;
    }
    
    .step.active .step-number,
    .step.current .step-number {
      background: rgba(255,255,255,0.2);
    }
    
    .step-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .step-detail {
      font-size: 0.85rem;
      opacity: 0.8;
      margin-left: 40px;
    }
    
    .highlight-box {
      background: rgba(255,255,255,0.1);
      border: 2px solid;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }
    
    .jwt-side .highlight-box {
      border-color: #667eea;
    }
    
    .cookie-side .highlight-box {
      border-color: #f5576c;
    }
    
    .highlight-title {
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    
    .highlight-content {
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      word-break: break-all;
      line-height: 1.6;
    }
    
    .status {
      text-align: center;
      padding: 10px;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 0.9rem;
    }
    
    .status.waiting {
      color: #ffc107;
    }
    
    .status.complete {
      color: #28a745;
    }
    
    .back-link {
      text-align: center;
      padding: 20px;
      background: #16213e;
      border-top: 2px solid #0f3460;
    }
    
    .back-link a {
      color: white;
      text-decoration: none;
      opacity: 0.7;
      transition: opacity 0.3s;
    }
    
    .back-link a:hover {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üî¨ Live Authentication Comparison</h1>
    <p>Watch JWT and Cookie authentication flows side-by-side in real-time</p>
  </div>

  <div class="split-container">
    <!-- JWT Side -->
    <div class="side jwt-side">
      <div class="side-header">
        <div class="side-icon">üé´</div>
        <h2 class="side-title">JWT (Token-Based)</h2>
        <p class="side-subtitle">Stateless Authentication</p>
      </div>

      <div class="status waiting" id="jwt-status">
        ‚è≥ Click button to start
      </div>

      <button class="start-btn jwt-btn" onclick="startJWTFlow()">
        Start JWT Flow ‚Üí
      </button>

      <div class="highlight-box" id="jwt-storage" style="display: none;">
        <div class="highlight-title">üíæ Storage Location</div>
        <div class="highlight-content">Client-side (localStorage/cookie)</div>
      </div>

      <div class="highlight-box" id="jwt-transmission" style="display: none;">
        <div class="highlight-title">üì° Transmission Method</div>
        <div class="highlight-content">Authorization: Bearer TOKEN</div>
      </div>

      <div class="highlight-box" id="jwt-validation" style="display: none;">
        <div class="highlight-title">‚úì Validation Method</div>
        <div class="highlight-content">Cryptographic signature (no DB lookup)</div>
      </div>

      <div class="highlight-box" id="jwt-token" style="display: none;">
        <div class="highlight-title">üé´ Token Content</div>
        <div class="highlight-content" id="jwt-token-content">...</div>
      </div>

      <div class="flow-steps">
        <div class="step" id="jwt-step-1">
          <span class="step-number">1</span>
          <div class="step-title">Authorization Request</div>
          <div class="step-detail">Redirect to OAuth server</div>
        </div>
        <div class="step" id="jwt-step-2">
          <span class="step-number">2</span>
          <div class="step-title">User Consent</div>
          <div class="step-detail">User approves application</div>
        </div>
        <div class="step" id="jwt-step-3">
          <span class="step-number">3</span>
          <div class="step-title">Code Exchange</div>
          <div class="step-detail">Exchange code for JWT token</div>
        </div>
        <div class="step" id="jwt-step-4">
          <span class="step-number">4</span>
          <div class="step-title">Token Received</div>
          <div class="step-detail">Store JWT on client</div>
        </div>
        <div class="step" id="jwt-step-5">
          <span class="step-number">5</span>
          <div class="step-title">API Request</div>
          <div class="step-detail">Send token in Authorization header</div>
        </div>
        <div class="step" id="jwt-step-6">
          <span class="step-number">6</span>
          <div class="step-title">Token Validation</div>
          <div class="step-detail">Server validates signature (stateless)</div>
        </div>
        <div class="step" id="jwt-step-7">
          <span class="step-number">7</span>
          <div class="step-title">Response</div>
          <div class="step-detail">Return user data</div>
        </div>
      </div>
    </div>

    <!-- Cookie Side -->
    <div class="side cookie-side">
      <div class="side-header">
        <div class="side-icon">üç™</div>
        <h2 class="side-title">Cookie (Session-Based)</h2>
        <p class="side-subtitle">Stateful Authentication</p>
      </div>

      <div class="status waiting" id="cookie-status">
        ‚è≥ Click button to start
      </div>

      <button class="start-btn cookie-btn" onclick="startCookieFlow()">
        Start Cookie Flow ‚Üí
      </button>

      <div class="highlight-box" id="cookie-storage" style="display: none;">
        <div class="highlight-title">üíæ Storage Location</div>
        <div class="highlight-content">Server-side (memory/Redis/DB)</div>
      </div>

      <div class="highlight-box" id="cookie-transmission" style="display: none;">
        <div class="highlight-title">üì° Transmission Method</div>
        <div class="highlight-content">Cookie: session_id=abc123 (auto-sent)</div>
      </div>

      <div class="highlight-box" id="cookie-validation" style="display: none;">
        <div class="highlight-title">‚úì Validation Method</div>
        <div class="highlight-content">Session lookup in database (stateful)</div>
      </div>

      <div class="highlight-box" id="cookie-session" style="display: none;">
        <div class="highlight-title">üç™ Session ID</div>
        <div class="highlight-content" id="cookie-session-content">...</div>
      </div>

      <div class="flow-steps">
        <div class="step" id="cookie-step-1">
          <span class="step-number">1</span>
          <div class="step-title">Authorization Request</div>
          <div class="step-detail">Redirect to OAuth server</div>
        </div>
        <div class="step" id="cookie-step-2">
          <span class="step-number">2</span>
          <div class="step-title">User Consent</div>
          <div class="step-detail">User approves application</div>
        </div>
        <div class="step" id="cookie-step-3">
          <span class="step-number">3</span>
          <div class="step-title">Code Exchange</div>
          <div class="step-detail">Exchange code for session</div>
        </div>
        <div class="step" id="cookie-step-4">
          <span class="step-number">4</span>
          <div class="step-title">Session Created</div>
          <div class="step-detail">Store session server-side, set cookie</div>
        </div>
        <div class="step" id="cookie-step-5">
          <span class="step-number">5</span>
          <div class="step-title">API Request</div>
          <div class="step-detail">Browser auto-sends cookie</div>
        </div>
        <div class="step" id="cookie-step-6">
          <span class="step-number">6</span>
          <div class="step-title">Session Lookup</div>
          <div class="step-detail">Server looks up session in DB (stateful)</div>
        </div>
        <div class="step" id="cookie-step-7">
          <span class="step-number">7</span>
          <div class="step-title">Response</div>
          <div class="step-detail">Return user data</div>
        </div>
      </div>
    </div>
  </div>

  <div class="back-link">
    <a href="/">‚Üê Back to Home</a> | 
    <a href="/compare">View Static Comparison</a>
  </div>

  <script>
    let jwtWindow = null;
    let cookieWindow = null;

    function startJWTFlow() {
      document.getElementById('jwt-status').textContent = 'üîÑ Opening OAuth window...';
      document.getElementById('jwt-status').className = 'status waiting';
      
      // Show info boxes
      document.getElementById('jwt-storage').style.display = 'block';
      document.getElementById('jwt-transmission').style.display = 'block';
      document.getElementById('jwt-validation').style.display = 'block';
      
      // Animate steps
      animateJWTSteps();
      
      // Open OAuth flow in popup
      jwtWindow = window.open(
        '/login/google',
        'jwt-oauth',
        'width=500,height=700'
      );
      
      // Poll for completion
      const checkJWT = setInterval(() => {
        try {
          if (jwtWindow && jwtWindow.closed) {
            clearInterval(checkJWT);
            document.getElementById('jwt-status').textContent = '‚úÖ Flow Complete';
            document.getElementById('jwt-status').className = 'status complete';
            completeJWTSteps();
          }
        } catch (e) {}
      }, 500);
    }

    function startCookieFlow() {
      document.getElementById('cookie-status').textContent = 'üîÑ Opening OAuth window...';
      document.getElementById('cookie-status').className = 'status waiting';
      
      // Show info boxes
      document.getElementById('cookie-storage').style.display = 'block';
      document.getElementById('cookie-transmission').style.display = 'block';
      document.getElementById('cookie-validation').style.display = 'block';
      
      // Animate steps
      animateCookieSteps();
      
      // Open OAuth flow in popup
      cookieWindow = window.open(
        '/login-cookie/google',
        'cookie-oauth',
        'width=500,height=700'
      );
      
      // Poll for completion
      const checkCookie = setInterval(() => {
        try {
          if (cookieWindow && cookieWindow.closed) {
            clearInterval(checkCookie);
            document.getElementById('cookie-status').textContent = '‚úÖ Flow Complete';
            document.getElementById('cookie-status').className = 'status complete';
            completeCookieSteps();
          }
        } catch (e) {}
      }, 500);
    }

    function animateJWTSteps() {
      const delays = [0, 1000, 2000, 3000, 4000, 5000, 6000];
      delays.forEach((delay, i) => {
        setTimeout(() => {
          // Remove current from previous
          if (i > 0) {
            document.getElementById(`jwt-step-${i}`).classList.remove('current');
            document.getElementById(`jwt-step-${i}`).classList.add('active');
          }
          // Set current
          document.getElementById(`jwt-step-${i + 1}`).classList.add('current');
        }, delay);
      });
    }

    function animateCookieSteps() {
      const delays = [0, 1000, 2000, 3000, 4000, 5000, 6000];
      delays.forEach((delay, i) => {
        setTimeout(() => {
          // Remove current from previous
          if (i > 0) {
            document.getElementById(`cookie-step-${i}`).classList.remove('current');
            document.getElementById(`cookie-step-${i}`).classList.add('active');
          }
          // Set current
          document.getElementById(`cookie-step-${i + 1}`).classList.add('current');
        }, delay);
      });
    }

    function completeJWTSteps() {
      for (let i = 1; i <= 7; i++) {
        document.getElementById(`jwt-step-${i}`).classList.remove('current');
        document.getElementById(`jwt-step-${i}`).classList.add('active');
      }
      document.getElementById('jwt-token').style.display = 'block';
      document.getElementById('jwt-token-content').textContent = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ...';
    }

    function completeCookieSteps() {
      for (let i = 1; i <= 7; i++) {
        document.getElementById(`cookie-step-${i}`).classList.remove('current');
        document.getElementById(`cookie-step-${i}`).classList.add('active');
      }
      document.getElementById('cookie-session').style.display = 'block';
      document.getElementById('cookie-session-content').textContent = 'session_id=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6 (httpOnly, secure, sameSite)';
    }
  </script>
</body>
</html>